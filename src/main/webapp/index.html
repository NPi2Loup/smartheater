<html>
<head>
<title>Sample "Hello, World" Application</title>
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
<script src="https://code.jquery.com/jquery-3.3.1.min.js"
	integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
	crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
<script src="https://unpkg.com/vue-router/dist/vue-router.js"></script>

<script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>
<script src="static/jquery.schedule.js"></script>
<link rel="stylesheet" href="static/jquery.schedule.css">
</head>
<body>
	<div id="app">
		 <router-view></router-view>
	</div>

	<script type="text/javascript">
		const WeeklyCalendar = {
		  template: `
		  	<div>
			  <form>
				  <div class="form-group row">
				  <label for="name" class="col-sm-2 col-form-label">Nom</label>
				    <div class="col-sm-10">
				    	<input v-model="weeklyCalendar.name" class="form-control" name="name" placeholder="">
				    </div>
				  </div>
				</form>
			  <input v-model="weeklyCalendar.jsonValue"  type=hidden name="jsonValue" >
			  <div id="schedule"></div>
			  <button v-on:click="save">Sauvegarder</button>
		  	</div>	
			 `,
		  beforeRouteEnter (to, from, next) {
			 $.get("api/weeklyCalendars/"+ to.params.id, data => {
		      next(vm => vm.setWeeklyCalendar(data))
		    })
		  },
		  beforeRouteUpdate (to, from, next) {
			  $.get("api/weeklyCalendars/"+ to.params.id, data => {
			      this.setWeeklyCalendar(data)
			    })
		  },
		  mounted: function () {
			  this.$nextTick(function () {
			  	$('#schedule').jqs();
			  });
		  },
		  methods: {
			  setWeeklyCalendar : function (data) {
				  this.$data.weeklyCalendar  = data
			  },
			  save : function () {
				  var weeklyCalendar = JSON.parse($('#schedule').jqs('export'));
				  //translate the format and then save the calendar
			  }
		  },
		  data: function () {
			  return {
		  		  weeklyCalendar:  {}
		  	  }
		  }
		}
		
		const WeeklyCalendarList = {
				  template: `
				  	<div>
						<table class="table">
						    <thead>
						      <tr>
						        <th scope="col">Id</th>
						        <th scope="col">Nom</th>
						      </tr>
						    </thead>
							<tbody>
								<tr v-for="weeklyCalendar in weeklyCalendars">
									<td>
									 	<router-link :to="{ path: '/weeklyCalendars/'+ weeklyCalendar.wcaId}">{{ weeklyCalendar.wcaId}}</router-link>
									</td>
									<td>
										{{ weeklyCalendar.name }}
									</td>
								</tr>
							</tbody>
						</table>
				  	</div>	
					 `,
				  beforeRouteEnter (to, from, next) {
					 $.get("api/weeklyCalendars", data => {
				      next(vm => vm.setWeeklyCalendars(data))
				    })
				  },
				  methods: {
					  setWeeklyCalendars : function (data) {
						  this.$data.weeklyCalendars  = data
					  }
				  },
				  data: function () {
					  return {
				  		  weeklyCalendars:  []
				  	  }
				  }
				}
		
		const router = new VueRouter({
		  routes: [
			{ path: '/weeklyCalendars/', component: WeeklyCalendarList },
			  // dynamic segments start with a colon
		    { path: '/weeklyCalendars/:id', component: WeeklyCalendar }
		  ]
		});
		
		
		var app = new Vue({
			  el: '#app',
			  router : router,
			  components: {
				  'weekly-calendar' : WeeklyCalendar,
				  'weekly-calendar-list' : WeeklyCalendarList
			  },
			  data: {
			    message: 'Hello Vue!'
			  }
			})
		
	</script>

	<script type="text/javascript">
		$.get("api/weeklyCalendars/1000", function(data) {
			console.log(JSON.parse(data.jsonValue));
		});
	</script>
</body>
</html>